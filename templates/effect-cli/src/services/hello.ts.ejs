import { Context, Effect, Layer } from 'effect';

export interface GreetOptions {
  greeting?: string;
  loud?: boolean;
}

export class HelloService extends Context.Tag('HelloService')<
  HelloService,
  {
    readonly greet: (name: string, options?: GreetOptions) => Effect.Effect<string>;
  }
>() {
  static readonly Default = Layer.succeed(
    HelloService,
    HelloService.of({
      greet: (name, options = {}) =>
        Effect.sync(() => {
          const greeting = options.greeting ?? 'Hello';
          let message = `${greeting}, ${name}!`;

          if (options.loud) {
            message = message.toUpperCase();
          }

          return message;
        }),
    })
  );
}
