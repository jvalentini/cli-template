<% if (apiFramework === 'hono') { -%>
import { Hono } from 'hono'
import { cors } from 'hono/cors'
import { logger } from 'hono/logger'
<% if (hasAddon('zod')) { -%>
import { z } from 'zod'
import { zValidator } from '@hono/zod-validator'
<% } -%>

const app = new Hono()

app.use('*', logger())
app.use(
  '*',
  cors({
    origin: ['http://localhost:5173', 'http://localhost:3000'],
  }),
)

app.get('/health', (c) => c.json({ status: 'healthy', timestamp: new Date().toISOString() }))
app.get('/api', (c) => c.json({ message: 'Welcome to <%= projectName %> API' }))

<% if (hasAddon('zod')) { -%>
const MessageSchema = z.object({
  text: z.string().min(1),
})

app.post('/api/messages', zValidator('json', MessageSchema), (c) => {
  const { text } = c.req.valid('json')
  return c.json({ id: crypto.randomUUID(), text, createdAt: new Date().toISOString() }, 201)
})
<% } else { -%>
app.post('/api/messages', async (c) => {
  const { text } = await c.req.json<{ text: string }>()
  return c.json({ id: crypto.randomUUID(), text, createdAt: new Date().toISOString() }, 201)
})
<% } -%>

app.notFound((c) => c.json({ error: 'Not Found' }, 404))

const port = parseInt(process.env.PORT || '3001', 10)
console.log(`ðŸš€ API running at http://localhost:${port}`)

export default { port, fetch: app.fetch }
<% } else if (apiFramework === 'express') { -%>
import express, { type Express } from 'express'
<% if (hasAddon('zod')) { -%>
import { z } from 'zod'
<% } -%>

const app: Express = express()

app.use(express.json())
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', '*')
  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS')
  res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization')
  if (req.method === 'OPTIONS') {
    res.sendStatus(200)
    return
  }
  next()
})

app.get('/health', (_req, res) => {
  res.json({ status: 'healthy', timestamp: new Date().toISOString() })
})

app.get('/api', (_req, res) => {
  res.json({ message: 'Welcome to <%= projectName %> API' })
})

<% if (hasAddon('zod')) { -%>
const MessageSchema = z.object({
  text: z.string().min(1),
})

app.post('/api/messages', (req, res) => {
  const result = MessageSchema.safeParse(req.body)
  if (!result.success) {
    res.status(400).json({ error: result.error.issues })
    return
  }
  const { text } = result.data
  res.status(201).json({ id: crypto.randomUUID(), text, createdAt: new Date().toISOString() })
})
<% } else { -%>
app.post('/api/messages', (req, res) => {
  const { text } = req.body as { text: string }
  res.status(201).json({ id: crypto.randomUUID(), text, createdAt: new Date().toISOString() })
})
<% } -%>

app.use((_req, res) => res.status(404).json({ error: 'Not Found' }))

const port = parseInt(process.env.PORT || '3001', 10)
app.listen(port, () => console.log(`ðŸš€ API running at http://localhost:${port}`))

export default app
<% } else if (apiFramework === 'elysia') { -%>
import { Elysia, t } from 'elysia'

const app = new Elysia()
  .get('/health', () => ({ status: 'healthy', timestamp: new Date().toISOString() }))
  .get('/api', () => ({ message: 'Welcome to <%= projectName %> API' }))
  .post(
    '/api/messages',
    ({ body }) => ({
      id: crypto.randomUUID(),
      text: body.text,
      createdAt: new Date().toISOString(),
    }),
    {
      body: t.Object({ text: t.String() }),
    },
  )
  .onError(({ code }) => {
    if (code === 'NOT_FOUND') return { error: 'Not Found' }
    return { error: 'Internal Server Error' }
  })

const port = parseInt(process.env.PORT || '3001', 10)
app.listen(port)
console.log(`ðŸš€ API running at http://localhost:${port}`)

export default app
<% } -%>
